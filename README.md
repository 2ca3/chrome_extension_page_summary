# Page Summary - Webページ要約Chrome拡張機能

WebページのコンテンツをLLMで要約し、指定した行数で簡潔にまとめるChrome拡張機能です。

## 機能

### 基本機能
- Webページの内容を自動で抽出して要約
- 要約行数を1〜100行の範囲で指定可能（デフォルト：10行）
- 複数のLLMプロバイダーに対応
  - OpenAI (GPT-4o, GPT-4o mini, o3-mini など)
  - Anthropic (Claude Opus 4.5, Sonnet 4.5, Haiku 4.5 など)
  - Google (Gemini 2.5 Flash, Gemini 3 Flash など)
- 要約結果のコピー機能
- API接続テスト機能

### マインドマップ生成機能
- 要約と同時にMermaid形式のマインドマップを生成
- 「要約 + マインドマップ」ボタンで両方を一度に取得
- 生成されたマインドマップはSVGとして表示
- Mermaid記法のコピー機能（外部ツールでの編集に対応）

### 単語説明機能 🆕
- 要約結果内の分からない単語を**ドラッグ選択するだけ**で即座にLLMが説明
- モーダルダイアログで説明を表示（元の要約は隠れない）
- 説明内の単語も同様に説明可能（**最大5階層までネスト対応**）
- キーボードショートカット対応（Ctrl+E / Cmd+E）
- ESCキーで1つずつモーダルを閉じる
- 最大5単語までの選択に対応
- 日本語・英語の混在テキストに対応

## インストール方法

### 1. Chromeへの読み込み

1. Chromeで `chrome://extensions/` を開く
2. 右上の「デベロッパーモード」を有効にする
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. このディレクトリ（page_summary）を選択

## 使い方

### 初期設定

1. 拡張機能アイコンをクリック
2. 「設定」ボタンをクリック
3. 使用するLLMプロバイダーを選択
4. 該当するAPIキーを入力
   - OpenAI: https://platform.openai.com/api-keys
   - Claude: https://console.anthropic.com/
   - Gemini: https://aistudio.google.com/app/apikey
5. 必要に応じてモデルを選択
6. 「保存」をクリック
7. 「接続テスト」で設定を確認（推奨）

### ページの要約

1. 要約したいWebページを開く
2. 拡張機能アイコンをクリック
3. 要約行数を指定（オプション）
4. 以下のいずれかをクリック:
   - **「要約する」**: 要約のみを生成
   - **「要約 + マインドマップ」**: 要約とマインドマップを同時に生成
5. 要約が表示されたら、必要に応じて「コピー」ボタンで内容をコピー

### 単語説明機能の使い方

要約結果が表示された後:

1. **ドラッグ選択で説明**: 分からない単語をマウスでドラッグして選択 → マウスボタンを離すと自動的にモーダルが表示される
2. **キーボードショートカット**: 単語を選択 → **Ctrl+E**（Windows）または **Cmd+E**（Mac）を押す
3. **ネストされた説明**: モーダル内の単語も同様にドラッグ選択で説明可能（最大5階層）
4. **モーダルを閉じる**:
   - **ESC**キーで最上位のモーダルを1つずつ閉じる
   - **×ボタン**をクリック
   - **オーバーレイの背景**をクリック

**制限事項**:
- 1回の選択は5単語まで
- 最大5階層まで（6階層目は開けません）

## プロジェクト構造

```
page_summary/
├── manifest.json           # 拡張機能のマニフェストファイル
├── background/
│   └── background.js      # バックグラウンドサービスワーカー（LLM API通信）
├── content/
│   └── content.js         # コンテンツスクリプト（ページ内容抽出）
├── popup/
│   ├── popup.html         # ポップアップUI
│   ├── popup.css          # ポップアップスタイル（モーダルスタイル含む）
│   └── popup.js           # ポップアップロジック（単語説明機能含む）
├── lib/
│   ├── marked.min.js      # Markdown→HTML変換ライブラリ
│   └── mermaid.min.js     # マインドマップ描画ライブラリ
├── options/
│   ├── options.html       # 設定画面UI
│   ├── options.css        # 設定画面スタイル
│   └── options.js         # 設定画面ロジック
├── icons/
│   ├── icon16.png         # 16x16アイコン（要作成）
│   ├── icon48.png         # 48x48アイコン（要作成）
│   ├── icon128.png        # 128x128アイコン（要作成）
│   └── README.md          # アイコン作成ガイド
└── README.md              # このファイル
```

## 技術仕様

- Manifest Version: 3
- 必要な権限:
  - `activeTab`: アクティブなタブのコンテンツにアクセス
  - `storage`: 設定とAPIキーの保存
  - `scripting`: コンテンツスクリプトの実行

## APIキーについて

- APIキーはChrome拡張機能のストレージに保存されます
- セキュリティのため、APIキーは他のユーザーと共有しないでください
- 各LLMプロバイダーの利用規約を確認してください

## 制限事項

- 大きなページの場合、コンテンツが長すぎてAPI制限に達する可能性があります
- LLMプロバイダーのAPI利用料金が発生します
- インターネット接続が必要です

## トラブルシューティング

### 要約が失敗する場合

1. 設定画面でAPIキーが正しく入力されているか確認
2. 「接続テスト」を実行して接続を確認
3. ページに十分なテキストコンテンツがあるか確認
4. ブラウザのコンソールでエラーメッセージを確認

### アイコンが表示されない場合

1. `icons/` ディレクトリに必要なPNGファイルがあるか確認
2. 拡張機能を再読み込み

## ライセンス

このプロジェクトは個人利用を想定しています。商用利用する場合は、各LLMプロバイダーのライセンスを確認してください。

## 開発者向け情報

### デバッグ方法

1. `chrome://extensions/` でデベロッパーモードを有効化
2. 拡張機能の「詳細」をクリック
3. 「バックグラウンドページを検証」でバックグラウンドスクリプトのログを確認
4. ポップアップを右クリック→「検証」でポップアップのログを確認

### カスタマイズ

- プロンプトの変更: [background/background.js](background/background.js) の各API呼び出し関数を編集
- UIのカスタマイズ: CSSファイルを編集
- 新しいLLMプロバイダーの追加: background.jsに新しい関数を追加し、options.htmlとpopup.jsを更新

## 今後の改善案

- 要約履歴の保存機能
- エクスポート機能（PDF、Markdown等）
- カスタムプロンプトの設定
- 複数言語対応
- オフラインモード（ローカルLLM対応）
- 単語説明のキャッシュ機能（既に説明した単語の再利用）
- 説明履歴サイドバー
- コンテキストメニュー統合（右クリックで説明）

## バージョン履歴

### v1.1.0 (最新)
- ✨ **単語説明機能を追加**: ドラッグ選択で即座に単語を説明
- ✨ **マインドマップ生成機能を追加**: 要約と同時にMermaid形式のマインドマップを生成
- 🎨 モーダルダイアログのUIを実装（ネスト対応、最大5階層）
- ⌨️ キーボードショートカット対応（Ctrl/Cmd+E、ESC）
- 🐛 バグ修正: ESCキーで親ウィンドウが閉じる問題を修正

### v1.0.0
- 🎉 初回リリース
- ✨ 基本的な要約機能
- ✨ 3つのLLMプロバイダー対応（OpenAI、Claude、Gemini）
- ⚙️ 設定画面とAPI接続テスト機能
